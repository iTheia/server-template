{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\marti\\\\projects\\\\server-template\\\\providers\\\\Auth\\\\index.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createContext, useState, useEffect, useContext } from \"react\";\nimport { AppContext } from \"../App\";\nimport JwtDecode from \"jwt-decode\";\nimport Axios from \"axios\";\nimport { ENDPOINT } from \"../../constants\";\nexport const AuthContext = /*#__PURE__*/createContext({\n  currentUser: false,\n  signUp: async () => {},\n  logOut: async () => {},\n  logIn: async () => {},\n  getToken: () => \"\"\n});\nexport const AuthProvider = ({\n  children\n}) => {\n  const {\n    0: currentUser,\n    1: setCurrentUser\n  } = useState(false);\n  const {\n    0: token,\n    1: setToken\n  } = useState(\"\");\n  const {\n    setIsLoading\n  } = useContext(AppContext);\n  useEffect(() => {\n    setIsLoading(true);\n    Axios.get(`${ENDPOINT}auth/current`, {\n      withCredentials: true\n    }).then(response => setSession(response));\n    setIsLoading(false);\n  }, [setIsLoading]);\n\n  async function setSession(response) {\n    try {\n      const {\n        data\n      } = response;\n\n      if (data.error) {\n        throw new Error(data.message);\n      }\n\n      const decoded = JwtDecode(data.token);\n      setCurrentUser(prev => _objectSpread(_objectSpread({}, prev), decoded));\n      setToken(data.token);\n      setIsLoading(false);\n    } catch (error) {\n      setIsLoading(false);\n    }\n  }\n\n  async function signUp(values) {\n    try {\n      const response = await Axios.post(`${ENDPOINT}auth/signup`, values);\n      setSession(response);\n    } catch (error) {\n      alert(error);\n    }\n  }\n\n  async function logOut() {\n    try {\n      await Axios.get(`${ENDPOINT}auth/close`);\n      setToken(\"\");\n      setCurrentUser(false);\n    } catch (error) {\n      alert(error);\n    }\n  }\n\n  async function logIn(values) {\n    try {\n      const response = await Axios.post(`${ENDPOINT}auth/login`, values);\n      setSession(response);\n    } catch (error) {\n      alert(error);\n    }\n  }\n\n  function getToken() {\n    if (token === \"\") {\n      return \"Bearrer \";\n    }\n\n    const {\n      exp\n    } = JwtDecode(token);\n\n    if (exp < Date.now().valueOf() / 1000) {\n      Axios.get(`${ENDPOINT}auth/current`).then(response => setSession(response)).catch(() => {\n        setToken(\"\");\n        setCurrentUser(false);\n      });\n    }\n\n    return `Bearrer ${token}`;\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      currentUser,\n      getToken,\n      logIn,\n      logOut,\n      signUp\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 9\n  }, this);\n};","map":{"version":3,"sources":["C:/Users/marti/projects/server-template/providers/Auth/index.tsx"],"names":["createContext","useState","useEffect","useContext","AppContext","JwtDecode","Axios","ENDPOINT","AuthContext","currentUser","signUp","logOut","logIn","getToken","AuthProvider","children","setCurrentUser","token","setToken","setIsLoading","get","withCredentials","then","response","setSession","data","error","Error","message","decoded","prev","values","post","alert","exp","Date","now","valueOf","catch"],"mappings":";;;;;;;;;AAAA,SAASA,aAAT,EAAwBC,QAAxB,EAAkCC,SAAlC,EAA6CC,UAA7C,QAA+D,OAA/D;AAEA,SAASC,UAAT,QAA2B,QAA3B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,iBAAzB;AAEA,OAAO,MAAMC,WAAW,gBAAGR,aAAa,CAAe;AACnDS,EAAAA,WAAW,EAAE,KADsC;AAEnDC,EAAAA,MAAM,EAAE,YAAY,CAAE,CAF6B;AAGnDC,EAAAA,MAAM,EAAE,YAAY,CAAE,CAH6B;AAInDC,EAAAA,KAAK,EAAE,YAAY,CAAE,CAJ8B;AAKnDC,EAAAA,QAAQ,EAAE,MAAM;AALmC,CAAf,CAAjC;AAQP,OAAO,MAAMC,YAAsB,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAkB;AACpD,QAAM;AAAA,OAACN,WAAD;AAAA,OAAcO;AAAd,MAAgCf,QAAQ,CAAgB,KAAhB,CAA9C;AACA,QAAM;AAAA,OAACgB,KAAD;AAAA,OAAQC;AAAR,MAAoBjB,QAAQ,CAAS,EAAT,CAAlC;AACA,QAAM;AAAEkB,IAAAA;AAAF,MAAmBhB,UAAU,CAACC,UAAD,CAAnC;AAEAF,EAAAA,SAAS,CAAC,MAAM;AACZiB,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACAb,IAAAA,KAAK,CAACc,GAAN,CAAW,GAAEb,QAAS,cAAtB,EAAqC;AACjCc,MAAAA,eAAe,EAAE;AADgB,KAArC,EAEGC,IAFH,CAESC,QAAD,IAAcC,UAAU,CAACD,QAAD,CAFhC;AAGAJ,IAAAA,YAAY,CAAC,KAAD,CAAZ;AACH,GANQ,EAMN,CAACA,YAAD,CANM,CAAT;;AAQA,iBAAeK,UAAf,CAA0BD,QAA1B,EAA+C;AAC3C,QAAI;AACA,YAAM;AAAEE,QAAAA;AAAF,UAAWF,QAAjB;;AACA,UAAIE,IAAI,CAACC,KAAT,EAAgB;AACZ,cAAM,IAAIC,KAAJ,CAAUF,IAAI,CAACG,OAAf,CAAN;AACH;;AACD,YAAMC,OAAO,GAAGxB,SAAS,CAACoB,IAAI,CAACR,KAAN,CAAzB;AACAD,MAAAA,cAAc,CAAEc,IAAD,oCAAgBA,IAAhB,GAAyBD,OAAzB,CAAD,CAAd;AACAX,MAAAA,QAAQ,CAACO,IAAI,CAACR,KAAN,CAAR;AACAE,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACH,KATD,CASE,OAAOO,KAAP,EAAc;AACZP,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACH;AACJ;;AAED,iBAAeT,MAAf,CAAsBqB,MAAtB,EAAuC;AACnC,QAAI;AACA,YAAMR,QAAQ,GAAG,MAAMjB,KAAK,CAAC0B,IAAN,CAAY,GAAEzB,QAAS,aAAvB,EAAqCwB,MAArC,CAAvB;AACAP,MAAAA,UAAU,CAACD,QAAD,CAAV;AACH,KAHD,CAGE,OAAOG,KAAP,EAAc;AACZO,MAAAA,KAAK,CAACP,KAAD,CAAL;AACH;AACJ;;AAED,iBAAef,MAAf,GAAwB;AACpB,QAAI;AACA,YAAML,KAAK,CAACc,GAAN,CAAW,GAAEb,QAAS,YAAtB,CAAN;AACAW,MAAAA,QAAQ,CAAC,EAAD,CAAR;AACAF,MAAAA,cAAc,CAAC,KAAD,CAAd;AACH,KAJD,CAIE,OAAOU,KAAP,EAAc;AACZO,MAAAA,KAAK,CAACP,KAAD,CAAL;AACH;AACJ;;AAED,iBAAed,KAAf,CAAqBmB,MAArB,EAAqC;AACjC,QAAI;AACA,YAAMR,QAAQ,GAAG,MAAMjB,KAAK,CAAC0B,IAAN,CAAY,GAAEzB,QAAS,YAAvB,EAAoCwB,MAApC,CAAvB;AACAP,MAAAA,UAAU,CAACD,QAAD,CAAV;AACH,KAHD,CAGE,OAAOG,KAAP,EAAc;AACZO,MAAAA,KAAK,CAACP,KAAD,CAAL;AACH;AACJ;;AACD,WAASb,QAAT,GAAoB;AAChB,QAAII,KAAK,KAAK,EAAd,EAAkB;AACd,aAAO,UAAP;AACH;;AACD,UAAM;AAAEiB,MAAAA;AAAF,QAAU7B,SAAS,CAACY,KAAD,CAAzB;;AACA,QAAIiB,GAAG,GAAGC,IAAI,CAACC,GAAL,GAAWC,OAAX,KAAuB,IAAjC,EAAuC;AACnC/B,MAAAA,KAAK,CAACc,GAAN,CAAW,GAAEb,QAAS,cAAtB,EACKe,IADL,CACWC,QAAD,IAAcC,UAAU,CAACD,QAAD,CADlC,EAEKe,KAFL,CAEW,MAAM;AACTpB,QAAAA,QAAQ,CAAC,EAAD,CAAR;AACAF,QAAAA,cAAc,CAAC,KAAD,CAAd;AACH,OALL;AAMH;;AACD,WAAQ,WAAUC,KAAM,EAAxB;AACH;;AAED,sBACI,QAAC,WAAD,CAAa,QAAb;AACI,IAAA,KAAK,EAAE;AAAER,MAAAA,WAAF;AAAeI,MAAAA,QAAf;AAAyBD,MAAAA,KAAzB;AAAgCD,MAAAA,MAAhC;AAAwCD,MAAAA;AAAxC,KADX;AAAA,cAGKK;AAHL;AAAA;AAAA;AAAA;AAAA,UADJ;AAOH,CA9EM","sourcesContent":["import { createContext, useState, useEffect, useContext } from \"react\";\r\nimport { IAuthContext, IUser, ILogIn, ISignUp, IResponse } from \"./types\";\r\nimport { AppContext } from \"../App\";\r\nimport JwtDecode from \"jwt-decode\";\r\nimport Axios from \"axios\";\r\nimport { ENDPOINT } from \"../../constants\";\r\n\r\nexport const AuthContext = createContext<IAuthContext>({\r\n    currentUser: false,\r\n    signUp: async () => {},\r\n    logOut: async () => {},\r\n    logIn: async () => {},\r\n    getToken: () => \"\",\r\n});\r\n\r\nexport const AuthProvider: React.FC = ({ children }) => {\r\n    const [currentUser, setCurrentUser] = useState<IUser | false>(false);\r\n    const [token, setToken] = useState<string>(\"\");\r\n    const { setIsLoading } = useContext(AppContext);\r\n\r\n    useEffect(() => {\r\n        setIsLoading(true);\r\n        Axios.get(`${ENDPOINT}auth/current`, {\r\n            withCredentials: true,\r\n        }).then((response) => setSession(response));\r\n        setIsLoading(false);\r\n    }, [setIsLoading]);\r\n\r\n    async function setSession(response: IResponse) {\r\n        try {\r\n            const { data } = response;\r\n            if (data.error) {\r\n                throw new Error(data.message);\r\n            }\r\n            const decoded = JwtDecode(data.token) as IUser;\r\n            setCurrentUser((prev) => ({ ...prev, ...decoded }));\r\n            setToken(data.token);\r\n            setIsLoading(false);\r\n        } catch (error) {\r\n            setIsLoading(false);\r\n        }\r\n    }\r\n\r\n    async function signUp(values: ISignUp) {\r\n        try {\r\n            const response = await Axios.post(`${ENDPOINT}auth/signup`, values);\r\n            setSession(response);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n\r\n    async function logOut() {\r\n        try {\r\n            await Axios.get(`${ENDPOINT}auth/close`);\r\n            setToken(\"\");\r\n            setCurrentUser(false);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n\r\n    async function logIn(values: ILogIn) {\r\n        try {\r\n            const response = await Axios.post(`${ENDPOINT}auth/login`, values);\r\n            setSession(response);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n    function getToken() {\r\n        if (token === \"\") {\r\n            return \"Bearrer \";\r\n        }\r\n        const { exp } = JwtDecode(token) as any;\r\n        if (exp < Date.now().valueOf() / 1000) {\r\n            Axios.get(`${ENDPOINT}auth/current`)\r\n                .then((response) => setSession(response))\r\n                .catch(() => {\r\n                    setToken(\"\");\r\n                    setCurrentUser(false);\r\n                });\r\n        }\r\n        return `Bearrer ${token}`;\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{ currentUser, getToken, logIn, logOut, signUp }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}