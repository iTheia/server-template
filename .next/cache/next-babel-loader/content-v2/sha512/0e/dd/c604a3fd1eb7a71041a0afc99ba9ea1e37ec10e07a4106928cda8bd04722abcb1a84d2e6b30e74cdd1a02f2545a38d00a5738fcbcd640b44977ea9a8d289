{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\marti\\\\projects\\\\server-template\\\\providers\\\\Auth\\\\index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useState, useEffect, useContext } from \"react\";\nimport { AppContext } from \"../App\";\nimport JwtDecode from \"jwt-decode\";\nimport Axios from \"axios\";\nimport { ENDPOINT } from \"../../constants\";\nexport var AuthContext = /*#__PURE__*/createContext({\n  currentUser: false,\n  signUp: function () {\n    var _signUp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function signUp() {\n      return _signUp.apply(this, arguments);\n    }\n\n    return signUp;\n  }(),\n  logOut: function () {\n    var _logOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    function logOut() {\n      return _logOut.apply(this, arguments);\n    }\n\n    return logOut;\n  }(),\n  logIn: function () {\n    var _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    function logIn() {\n      return _logIn.apply(this, arguments);\n    }\n\n    return logIn;\n  }(),\n  getToken: function getToken() {\n    return \"\";\n  }\n});\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useState = useState(false),\n      currentUser = _useState[0],\n      setCurrentUser = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      token = _useState2[0],\n      setToken = _useState2[1];\n\n  var _useContext = useContext(AppContext),\n      setIsLoading = _useContext.setIsLoading;\n\n  useEffect(function () {\n    setIsLoading(true);\n    Axios.get(\"\".concat(ENDPOINT, \"auth/current\"), {\n      withCredentials: true\n    }).then(function (response) {\n      return setSession(response);\n    });\n    setIsLoading(false);\n  }, [setIsLoading]);\n\n  function setSession(_x) {\n    return _setSession.apply(this, arguments);\n  }\n\n  function _setSession() {\n    _setSession = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response) {\n      var data, decoded;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              data = response.data;\n\n              if (!data.error) {\n                _context4.next = 4;\n                break;\n              }\n\n              throw new Error(data.message);\n\n            case 4:\n              decoded = JwtDecode(data.token);\n              setCurrentUser(function (prev) {\n                return _objectSpread(_objectSpread({}, prev), decoded);\n              });\n              setToken(data.token);\n              setIsLoading(false);\n              _context4.next = 13;\n              break;\n\n            case 10:\n              _context4.prev = 10;\n              _context4.t0 = _context4[\"catch\"](0);\n              setIsLoading(false);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 10]]);\n    }));\n    return _setSession.apply(this, arguments);\n  }\n\n  function signUp(_x2) {\n    return _signUp2.apply(this, arguments);\n  }\n\n  function _signUp2() {\n    _signUp2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(values) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return Axios.post(\"\".concat(ENDPOINT, \"auth/signup\"), values);\n\n            case 3:\n              response = _context5.sent;\n              setSession(response);\n              _context5.next = 10;\n              break;\n\n            case 7:\n              _context5.prev = 7;\n              _context5.t0 = _context5[\"catch\"](0);\n              alert(_context5.t0);\n\n            case 10:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 7]]);\n    }));\n    return _signUp2.apply(this, arguments);\n  }\n\n  function logOut() {\n    return _logOut2.apply(this, arguments);\n  }\n\n  function _logOut2() {\n    _logOut2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 3;\n              return Axios.get(\"\".concat(ENDPOINT, \"auth/close\"));\n\n            case 3:\n              setToken(\"\");\n              setCurrentUser(false);\n              _context6.next = 10;\n              break;\n\n            case 7:\n              _context6.prev = 7;\n              _context6.t0 = _context6[\"catch\"](0);\n              alert(_context6.t0);\n\n            case 10:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, null, [[0, 7]]);\n    }));\n    return _logOut2.apply(this, arguments);\n  }\n\n  function logIn(_x3) {\n    return _logIn2.apply(this, arguments);\n  }\n\n  function _logIn2() {\n    _logIn2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(values) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.prev = 0;\n              _context7.next = 3;\n              return Axios.post(\"\".concat(ENDPOINT, \"auth/login\"), values);\n\n            case 3:\n              response = _context7.sent;\n              setSession(response);\n              _context7.next = 10;\n              break;\n\n            case 7:\n              _context7.prev = 7;\n              _context7.t0 = _context7[\"catch\"](0);\n              alert(_context7.t0);\n\n            case 10:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, null, [[0, 7]]);\n    }));\n    return _logIn2.apply(this, arguments);\n  }\n\n  function getToken() {\n    if (token === \"\") {\n      return \"Bearrer \";\n    }\n\n    var _ref2 = JwtDecode(token),\n        exp = _ref2.exp;\n\n    if (exp < Date.now().valueOf() / 1000) {\n      Axios.get(\"\".concat(ENDPOINT, \"auth/current\")).then(function (response) {\n        return setSession(response);\n      })[\"catch\"](function () {\n        setToken(\"\");\n        setCurrentUser(false);\n      });\n    }\n\n    return \"Bearrer \".concat(token);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      currentUser: currentUser,\n      getToken: getToken,\n      logIn: logIn,\n      logOut: logOut,\n      signUp: signUp\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(AuthProvider, \"bIiaQ2AMdLUHjhMOC2Y8+SwCXpc=\");\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/marti/projects/server-template/providers/Auth/index.tsx"],"names":["createContext","useState","useEffect","useContext","AppContext","JwtDecode","Axios","ENDPOINT","AuthContext","currentUser","signUp","logOut","logIn","getToken","AuthProvider","children","setCurrentUser","token","setToken","setIsLoading","get","withCredentials","then","response","setSession","data","error","Error","message","decoded","prev","values","post","alert","exp","Date","now","valueOf"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect, useContext } from \"react\";\r\nimport { IAuthContext, IUser, ILogIn, ISignUp, IResponse } from \"./types\";\r\nimport { AppContext } from \"../App\";\r\nimport JwtDecode from \"jwt-decode\";\r\nimport Axios from \"axios\";\r\nimport { ENDPOINT } from \"../../constants\";\r\n\r\nexport const AuthContext = createContext<IAuthContext>({\r\n    currentUser: false,\r\n    signUp: async () => {},\r\n    logOut: async () => {},\r\n    logIn: async () => {},\r\n    getToken: () => \"\",\r\n});\r\n\r\nexport const AuthProvider: React.FC = ({ children }) => {\r\n    const [currentUser, setCurrentUser] = useState<IUser | false>(false);\r\n    const [token, setToken] = useState<string>(\"\");\r\n    const { setIsLoading } = useContext(AppContext);\r\n\r\n    useEffect(() => {\r\n        setIsLoading(true);\r\n        Axios.get(`${ENDPOINT}auth/current`, {\r\n            withCredentials: true,\r\n        }).then((response) => setSession(response));\r\n        setIsLoading(false);\r\n    }, [setIsLoading]);\r\n\r\n    async function setSession(response: IResponse) {\r\n        try {\r\n            const { data } = response;\r\n            if (data.error) {\r\n                throw new Error(data.message);\r\n            }\r\n            const decoded = JwtDecode(data.token) as IUser;\r\n            setCurrentUser((prev) => ({ ...prev, ...decoded }));\r\n            setToken(data.token);\r\n            setIsLoading(false);\r\n        } catch (error) {\r\n            setIsLoading(false);\r\n        }\r\n    }\r\n\r\n    async function signUp(values: ISignUp) {\r\n        try {\r\n            const response = await Axios.post(`${ENDPOINT}auth/signup`, values);\r\n            setSession(response);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n\r\n    async function logOut() {\r\n        try {\r\n            await Axios.get(`${ENDPOINT}auth/close`);\r\n            setToken(\"\");\r\n            setCurrentUser(false);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n\r\n    async function logIn(values: ILogIn) {\r\n        try {\r\n            const response = await Axios.post(`${ENDPOINT}auth/login`, values);\r\n            setSession(response);\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n    function getToken() {\r\n        if (token === \"\") {\r\n            return \"Bearrer \";\r\n        }\r\n        const { exp } = JwtDecode(token) as any;\r\n        if (exp < Date.now().valueOf() / 1000) {\r\n            Axios.get(`${ENDPOINT}auth/current`)\r\n                .then((response) => setSession(response))\r\n                .catch(() => {\r\n                    setToken(\"\");\r\n                    setCurrentUser(false);\r\n                });\r\n        }\r\n        return `Bearrer ${token}`;\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{ currentUser, getToken, logIn, logOut, signUp }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}